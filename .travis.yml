language: scala
sudo: true
scala:
  - 2.12.8
jdk:
  - oraclejdk8
install: true

services:
  - docker

before_cache:
  # Cleanup the cached directories to avoid unnecessary cache updates
  - rm -fv $HOME/.ivy2/.sbt.ivy.lock
  - find $HOME/.ivy2/cache -name "ivydata-*.properties" -print -delete
  - find $HOME/.sbt        -name "*.lock"               -print -delete

cache:
  directories:
    - $HOME/.ivy2/cache
    - $HOME/.sbt

before_install:
  - docker run -d -p 8000:8000 dwmkerr/dynamodb

script:
  - sbt clean coverage test coverageReport

after_success:
  - bash <(curl -s https://codecov.io/bash)

before_deploy: sbt dist
deploy:
  provider: releases
  api_key:
    secure: "DulQ5VFOM1kN8QBcesRRb3hY+HWl4N32aBtkTwlkFfwCp1CzwYrqrxSnjWJbT60WpxojXhPcz+xJftRVJKSieG2spz3PKSvH+RgQBsgZG8aPWq2kOp3smlGM0aJV+wxCTVX8+m10KPFBp3+XWmHlbXVanrI3XDf3dRCqI1GPFS43aH1m6EsJNA7gW2oxNFS0/STSV2eXd6F97cVYgDufA7jQs/obuV99iD7j5+hoUcUZj6AjGchUQzAUZDPvolJQzrpG95QXKZI4/SoEfQXcn+8rbeBVW2FGwGdoCAhAmQOxwPtAsh4H9w8HWJ47pVTrjq/QfOFTJ4MvxtMdIrJZ4ojt+eVyAj2lHkro0VmXKBzvsCSoW+wuzQgyap+mGQJ0SRdAaS2M18f8l95Zlezh2Dusn43cDKQQ2yGy0hBtwjOkhrj+f78daHp/BGEj6aK03OLrYwk1Pg68tKkTgDQukMLiQTsjzZ43r/v0QKtfzfz1Y2pY7GIZOu11PzHVrEUB9FPHYmHXa7A9Lxl8CAC+mEV9zpMh6x6nLmCzgFWJvK/5kBSps0xxyG8c4VmbQj3d8FtLc/sxh1eCxjvtDfOwShQt0SnOQhy9cgeTYJQL8SAdynvY5iHPLP0Gynm989Sc6rmfeztoYA9AdnxPlHSFYDlYMQ4WyGqTq63OMsRXSL8="
  file: "server/target/universal/*.zip"
  skip_cleanup: true
  on:
    tags: true